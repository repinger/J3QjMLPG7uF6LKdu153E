<!doctype html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<title>User Manager Integration</title>
		<link
			href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
			rel="stylesheet"
		/>
	</head>
	<body class="bg-light">
		<div class="container mt-5">
			<div class="card shadow">
				<div class="card-header bg-primary text-white">
					<h3>User Manager (Authentik + Stalwart)</h3>
				</div>
				<div class="card-body">
					{% with messages = get_flashed_messages(with_categories=true) %} {% if
					messages %} {% for category, message in messages %}
					<div class="alert alert-{{ category }}">{{ message }}</div>
					{% endfor %} {% endif %} {% endwith %}

					<form action="/create" method="POST" class="row g-3 mb-4">
						<div class="col-md-3">
							<label class="form-label">Username</label>
							<input
								type="text"
								name="username"
								class="form-control"
								placeholder="jdoe"
								required
							/>
						</div>
						<div class="col-md-3">
							<label class="form-label">Email</label>
							<input
								type="email"
								name="email"
								class="form-control"
								placeholder="user@domain.com"
								required
							/>
						</div>
						<div class="col-md-2">
							<label class="form-label">Group</label>
							<select name="group" class="form-select">
								<option value="">-- No Group --</option>
								{% for group in groups %}
								<option value="{{ group.pk }}">{{ group.name }}</option>
								{% endfor %}
							</select>
						</div>
						<div class="col-md-2">
							<label class="form-label">Password</label>
							<input
								type="password"
								name="password"
								class="form-control"
								placeholder="Secret123"
								required
							/>
						</div>
						<div class="col-md-2 d-flex align-items-end">
							<button type="submit" class="btn btn-success w-100">
								Add User
							</button>
						</div>
					</form>

					<table class="table table-striped align-middle">
						<thead>
							<tr>
								<th>Username</th>
								<th>Name</th>
								<th>Email</th>
								<th>Groups</th>
								<th>Action</th>
							</tr>
						</thead>
						<tbody>
							{% for user in users %}
							<tr>
								<td>{{ user.username }}</td>
								<td>{{ user.name }}</td>
								<td>{{ user.email }}</td>
								<td>
									<span class="badge bg-secondary"
										>{{ user.groups|length }} Group(s)</span
									>
								</td>
								<td>
									<form
										action="/delete/{{ user.pk }}"
										method="POST"
										onsubmit="return confirm('Delete {{ user.username }}?');"
									>
										<input
											type="hidden"
											name="username_hidden"
											value="{{ user.username }}"
										/>
										<button class="btn btn-danger btn-sm">Delete</button>
									</form>
								</td>
							</tr>
							{% endfor %}
						</tbody>
					</table>
				</div>
			</div>
		</div>
	</body>
</html>
